{"version":3,"file":"calendar.component.js","sources":["calendar.component.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAMO;AACP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;oBAA0B;AAC1B;AACA;AACA;AACA","sourcesContent":["\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar core_1 = require(\"@angular/core\");\r\nvar calendar_service_1 = require(\"../services/calendar.service\");\r\nvar forms_1 = require(\"@angular/forms\");\r\nvar moment_ = require(\"moment\");\r\nvar moment = moment_;\r\nvar config_1 = require(\"../config\");\r\nexports.ION_CAL_VALUE_ACCESSOR = {\r\n    provide: forms_1.NG_VALUE_ACCESSOR,\r\n    useExisting: core_1.forwardRef(function () { return CalendarComponent; }),\r\n    multi: true\r\n};\r\nvar CalendarComponent = /** @class */ (function () {\r\n    function CalendarComponent(calSvc) {\r\n        this.calSvc = calSvc;\r\n        this._view = 'days';\r\n        this._calendarMonthValue = [null, null];\r\n        this._showToggleButtons = true;\r\n        this._showMonthPicker = true;\r\n        this.format = config_1.defaults.DATE_FORMAT;\r\n        this.type = 'string';\r\n        this.readonly = false;\r\n        this.onChange = new core_1.EventEmitter();\r\n        this.monthChange = new core_1.EventEmitter();\r\n        this.onSelect = new core_1.EventEmitter();\r\n        this.onSelectStart = new core_1.EventEmitter();\r\n        this.onSelectEnd = new core_1.EventEmitter();\r\n        this._onChanged = function () {\r\n        };\r\n        this._onTouched = function () {\r\n        };\r\n    }\r\n    Object.defineProperty(CalendarComponent.prototype, \"showToggleButtons\", {\r\n        get: function () {\r\n            return this._showToggleButtons;\r\n        },\r\n        set: function (value) {\r\n            this._showToggleButtons = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CalendarComponent.prototype, \"showMonthPicker\", {\r\n        get: function () {\r\n            return this._showMonthPicker;\r\n        },\r\n        set: function (value) {\r\n            this._showMonthPicker = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CalendarComponent.prototype, \"options\", {\r\n        get: function () {\r\n            return this._options;\r\n        },\r\n        set: function (value) {\r\n            this._options = value;\r\n            this.initOpt();\r\n            if (this.monthOpt && this.monthOpt.original) {\r\n                this.monthOpt = this.createMonth(this.monthOpt.original.time);\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CalendarComponent.prototype.ngOnInit = function () {\r\n        this.initOpt();\r\n        this.monthOpt = this.createMonth(new Date().getTime());\r\n    };\r\n    CalendarComponent.prototype.getViewDate = function () {\r\n        return this._handleType(this.monthOpt.original.time);\r\n    };\r\n    CalendarComponent.prototype.setViewDate = function (value) {\r\n        this.monthOpt = this.createMonth(this._payloadToTimeNumber(value));\r\n    };\r\n    CalendarComponent.prototype.switchView = function () {\r\n        this._view = this._view === 'days' ? 'month' : 'days';\r\n    };\r\n    CalendarComponent.prototype.prev = function () {\r\n        if (this._view === 'days') {\r\n            this.backMonth();\r\n        }\r\n        else {\r\n            this.prevYear();\r\n        }\r\n    };\r\n    CalendarComponent.prototype.next = function () {\r\n        if (this._view === 'days') {\r\n            this.nextMonth();\r\n        }\r\n        else {\r\n            this.nextYear();\r\n        }\r\n    };\r\n    CalendarComponent.prototype.prevYear = function () {\r\n        if (moment(this.monthOpt.original.time).year() === 1970)\r\n            return;\r\n        var backTime = moment(this.monthOpt.original.time).subtract(1, 'year').valueOf();\r\n        this.monthOpt = this.createMonth(backTime);\r\n    };\r\n    CalendarComponent.prototype.nextYear = function () {\r\n        var nextTime = moment(this.monthOpt.original.time).add(1, 'year').valueOf();\r\n        this.monthOpt = this.createMonth(nextTime);\r\n    };\r\n    CalendarComponent.prototype.nextMonth = function () {\r\n        var nextTime = moment(this.monthOpt.original.time).add(1, 'months').valueOf();\r\n        this.monthChange.emit({\r\n            oldMonth: this.calSvc.multiFormat(this.monthOpt.original.time),\r\n            newMonth: this.calSvc.multiFormat(nextTime)\r\n        });\r\n        this.monthOpt = this.createMonth(nextTime);\r\n    };\r\n    CalendarComponent.prototype.canNext = function () {\r\n        if (!this._d.to || this._view !== 'days')\r\n            return true;\r\n        return this.monthOpt.original.time < moment(this._d.to).valueOf();\r\n    };\r\n    CalendarComponent.prototype.backMonth = function () {\r\n        var backTime = moment(this.monthOpt.original.time).subtract(1, 'months').valueOf();\r\n        this.monthChange.emit({\r\n            oldMonth: this.calSvc.multiFormat(this.monthOpt.original.time),\r\n            newMonth: this.calSvc.multiFormat(backTime)\r\n        });\r\n        this.monthOpt = this.createMonth(backTime);\r\n    };\r\n    CalendarComponent.prototype.canBack = function () {\r\n        if (!this._d.from || this._view !== 'days')\r\n            return true;\r\n        return this.monthOpt.original.time > moment(this._d.from).valueOf();\r\n    };\r\n    CalendarComponent.prototype.monthOnSelect = function (month) {\r\n        this._view = 'days';\r\n        var newMonth = moment(this.monthOpt.original.time).month(month).valueOf();\r\n        this.monthChange.emit({\r\n            oldMonth: this.calSvc.multiFormat(this.monthOpt.original.time),\r\n            newMonth: this.calSvc.multiFormat(newMonth)\r\n        });\r\n        this.monthOpt = this.createMonth(newMonth);\r\n    };\r\n    CalendarComponent.prototype.onChanged = function ($event) {\r\n        switch (this._d.pickMode) {\r\n            case config_1.pickModes.SINGLE:\r\n                var date = this._handleType($event[0].time);\r\n                this._onChanged(date);\r\n                this.onChange.emit(date);\r\n                break;\r\n            case config_1.pickModes.RANGE:\r\n                if ($event[0] && $event[1]) {\r\n                    var rangeDate = {\r\n                        from: this._handleType($event[0].time),\r\n                        to: this._handleType($event[1].time)\r\n                    };\r\n                    this._onChanged(rangeDate);\r\n                    this.onChange.emit(rangeDate);\r\n                }\r\n                break;\r\n            case config_1.pickModes.MULTI:\r\n                var dates = [];\r\n                for (var i = 0; i < $event.length; i++) {\r\n                    if ($event[i] && $event[i].time) {\r\n                        dates.push(this._handleType($event[i].time));\r\n                    }\r\n                }\r\n                this._onChanged(dates);\r\n                this.onChange.emit(dates);\r\n                break;\r\n            default:\r\n        }\r\n    };\r\n    CalendarComponent.prototype.swipeEvent = function ($event) {\r\n        var isNext = $event.deltaX < 0;\r\n        if (isNext && this.canNext()) {\r\n            this.nextMonth();\r\n        }\r\n        else if (!isNext && this.canBack()) {\r\n            this.backMonth();\r\n        }\r\n    };\r\n    CalendarComponent.prototype._payloadToTimeNumber = function (value) {\r\n        var date;\r\n        if (this.type === 'string') {\r\n            date = moment(value, this.format);\r\n        }\r\n        else {\r\n            date = moment(value);\r\n        }\r\n        return date.valueOf();\r\n    };\r\n    CalendarComponent.prototype._monthFormat = function (date) {\r\n        return moment(date).format(this._d.monthFormat.replace(/y/g, 'Y'));\r\n    };\r\n    CalendarComponent.prototype.initOpt = function () {\r\n        if (this._options && typeof this._options.showToggleButtons === 'boolean') {\r\n            this.showToggleButtons = this._options.showToggleButtons;\r\n        }\r\n        if (this._options && typeof this._options.showMonthPicker === 'boolean') {\r\n            this.showMonthPicker = this._options.showMonthPicker;\r\n            if (this._view !== 'days' && !this.showMonthPicker) {\r\n                this._view = 'days';\r\n            }\r\n        }\r\n        this._d = this.calSvc.safeOpt(this._options || {});\r\n    };\r\n    CalendarComponent.prototype.createMonth = function (date) {\r\n        return this.calSvc.createMonthsByPeriod(date, 1, this._d)[0];\r\n    };\r\n    CalendarComponent.prototype._createCalendarDay = function (value) {\r\n        return this.calSvc.createCalendarDay(this._payloadToTimeNumber(value), this._d);\r\n    };\r\n    CalendarComponent.prototype._handleType = function (value) {\r\n        var date = moment(value);\r\n        switch (this.type) {\r\n            case 'string':\r\n                return date.format(this.format);\r\n            case 'js-date':\r\n                return date.toDate();\r\n            case 'moment':\r\n                return date;\r\n            case 'time':\r\n                return date.valueOf();\r\n            case 'object':\r\n                return date.toObject();\r\n        }\r\n        return date;\r\n    };\r\n    CalendarComponent.prototype.writeValue = function (obj) {\r\n        this._writeValue(obj);\r\n        if (obj) {\r\n            if (this._calendarMonthValue[0]) {\r\n                this.monthOpt = this.createMonth(this._calendarMonthValue[0].time);\r\n            }\r\n            else {\r\n                this.monthOpt = this.createMonth(new Date().getTime());\r\n            }\r\n        }\r\n    };\r\n    CalendarComponent.prototype.registerOnChange = function (fn) {\r\n        this._onChanged = fn;\r\n    };\r\n    CalendarComponent.prototype.registerOnTouched = function (fn) {\r\n        this._onTouched = fn;\r\n    };\r\n    CalendarComponent.prototype._writeValue = function (value) {\r\n        var _this = this;\r\n        if (!value) {\r\n            this._calendarMonthValue = [null, null];\r\n            return;\r\n        }\r\n        switch (this._d.pickMode) {\r\n            case 'single':\r\n                this._calendarMonthValue[0] = this._createCalendarDay(value);\r\n                break;\r\n            case 'range':\r\n                if (value.from) {\r\n                    this._calendarMonthValue[0] = value.from ? this._createCalendarDay(value.from) : null;\r\n                }\r\n                if (value.to) {\r\n                    this._calendarMonthValue[1] = value.to ? this._createCalendarDay(value.to) : null;\r\n                }\r\n                break;\r\n            case 'multi':\r\n                if (Array.isArray(value)) {\r\n                    this._calendarMonthValue = value.map(function (e) {\r\n                        return _this._createCalendarDay(e);\r\n                    });\r\n                }\r\n                else {\r\n                    this._calendarMonthValue = [null, null];\r\n                }\r\n                break;\r\n            default:\r\n        }\r\n    };\r\n    __decorate([\r\n        core_1.Input(),\r\n        __metadata(\"design:type\", String)\r\n    ], CalendarComponent.prototype, \"format\", void 0);\r\n    __decorate([\r\n        core_1.Input(),\r\n        __metadata(\"design:type\", String)\r\n    ], CalendarComponent.prototype, \"type\", void 0);\r\n    __decorate([\r\n        core_1.Input(),\r\n        __metadata(\"design:type\", Object)\r\n    ], CalendarComponent.prototype, \"readonly\", void 0);\r\n    __decorate([\r\n        core_1.Output(),\r\n        __metadata(\"design:type\", core_1.EventEmitter)\r\n    ], CalendarComponent.prototype, \"onChange\", void 0);\r\n    __decorate([\r\n        core_1.Output(),\r\n        __metadata(\"design:type\", core_1.EventEmitter)\r\n    ], CalendarComponent.prototype, \"monthChange\", void 0);\r\n    __decorate([\r\n        core_1.Output(),\r\n        __metadata(\"design:type\", core_1.EventEmitter)\r\n    ], CalendarComponent.prototype, \"onSelect\", void 0);\r\n    __decorate([\r\n        core_1.Output(),\r\n        __metadata(\"design:type\", core_1.EventEmitter)\r\n    ], CalendarComponent.prototype, \"onSelectStart\", void 0);\r\n    __decorate([\r\n        core_1.Output(),\r\n        __metadata(\"design:type\", core_1.EventEmitter)\r\n    ], CalendarComponent.prototype, \"onSelectEnd\", void 0);\r\n    __decorate([\r\n        core_1.Input(),\r\n        __metadata(\"design:type\", Object),\r\n        __metadata(\"design:paramtypes\", [Object])\r\n    ], CalendarComponent.prototype, \"options\", null);\r\n    CalendarComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'ion-calendar',\r\n            providers: [exports.ION_CAL_VALUE_ACCESSOR],\r\n            template: \"\\n    <div class=\\\"title\\\">\\n      <ng-template [ngIf]=\\\"_showMonthPicker\\\" [ngIfElse]=\\\"title\\\">\\n        <ion-button type=\\\"button\\\"\\n                fill=\\\"clear\\\"\\n                class=\\\"switch-btn\\\"\\n                (click)=\\\"switchView()\\\">\\n          {{_monthFormat(monthOpt.original.time)}}\\n          <ion-icon class=\\\"arrow-dropdown\\\"\\n                    [name]=\\\"_view === 'days' ? 'md-arrow-dropdown' : 'md-arrow-dropup'\\\"></ion-icon>\\n        </ion-button>\\n      </ng-template>\\n      <ng-template #title>\\n        <div class=\\\"switch-btn\\\">\\n          {{_monthFormat(monthOpt.original.time)}}\\n        </div>\\n      </ng-template>\\n      <ng-template [ngIf]=\\\"_showToggleButtons\\\">\\n        <ion-button type='button' fill=\\\"clear\\\" class=\\\"back\\\" [disabled]=\\\"!canBack()\\\" (click)=\\\"prev()\\\">\\n          <ion-icon name=\\\"ios-arrow-back\\\"></ion-icon>\\n        </ion-button>\\n        <ion-button type='button' fill=\\\"clear\\\" class=\\\"forward\\\" [disabled]=\\\"!canNext()\\\" (click)=\\\"next()\\\">\\n          <ion-icon name=\\\"ios-arrow-forward\\\"></ion-icon>\\n        </ion-button>\\n      </ng-template>\\n    </div>\\n    <ng-template [ngIf]=\\\"_view === 'days'\\\" [ngIfElse]=\\\"monthPicker\\\">\\n      <ion-calendar-week color=\\\"transparent\\\"\\n                         [weekArray]=\\\"_d.weekdays\\\"\\n                         [weekStart]=\\\"_d.weekStart\\\">\\n      </ion-calendar-week>\\n\\n      <ion-calendar-month class=\\\"component-mode\\\"\\n                          [(ngModel)]=\\\"_calendarMonthValue\\\"\\n                          [month]=\\\"monthOpt\\\"\\n                          [readonly]=\\\"readonly\\\"\\n                          (onChange)=\\\"onChanged($event)\\\"\\n                          (swipe)=\\\"swipeEvent($event)\\\"\\n                          (onSelect)=\\\"onSelect.emit($event)\\\"\\n                          (onSelectStart)=\\\"onSelectStart.emit($event)\\\"\\n                          (onSelectEnd)=\\\"onSelectEnd.emit($event)\\\"\\n                          [pickMode]=\\\"_d.pickMode\\\"\\n                          [color]=\\\"_d.color\\\">\\n      </ion-calendar-month>\\n    </ng-template>\\n\\n    <ng-template #monthPicker>\\n      <ion-calendar-month-picker [color]=\\\"_d.color\\\"\\n                                 [monthFormat]=\\\"_options?.monthPickerFormat\\\"\\n                                 (onSelect)=\\\"monthOnSelect($event)\\\"\\n                                 [month]=\\\"monthOpt\\\">\\n      </ion-calendar-month-picker>\\n    </ng-template>\\n  \"\r\n        }),\r\n        __metadata(\"design:paramtypes\", [calendar_service_1.CalendarService])\r\n    ], CalendarComponent);\r\n    return CalendarComponent;\r\n}());\r\nexports.CalendarComponent = CalendarComponent;\r\n"]}