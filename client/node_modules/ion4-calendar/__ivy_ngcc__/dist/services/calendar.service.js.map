{"version":3,"file":"calendar.service.js","sources":["calendar.service.js"],"names":[],"mappings":"AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAEO;AACP;;;;;gDAAwB;AACxB;AACA;AACA;AACA","sourcesContent":["\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar core_1 = require(\"@angular/core\");\r\nvar moment_ = require(\"moment\");\r\nvar moment = moment_;\r\nvar config_1 = require(\"../config\");\r\nvar CalendarService = /** @class */ (function () {\r\n    function CalendarService() {\r\n    }\r\n    CalendarService.prototype.safeOpt = function (calendarOptions) {\r\n        var _disableWeeks = [];\r\n        var _daysConfig = [];\r\n        var _a = calendarOptions || {}, _b = _a.from, from = _b === void 0 ? new Date() : _b, _c = _a.to, to = _c === void 0 ? 0 : _c, _d = _a.weekStart, weekStart = _d === void 0 ? 0 : _d, _e = _a.step, step = _e === void 0 ? 3 : _e, _f = _a.id, id = _f === void 0 ? '' : _f, _g = _a.cssClass, cssClass = _g === void 0 ? '' : _g, _h = _a.closeLabel, closeLabel = _h === void 0 ? 'CANCEL' : _h, _j = _a.doneLabel, doneLabel = _j === void 0 ? 'DONE' : _j, _k = _a.monthFormat, monthFormat = _k === void 0 ? 'MMM YYYY' : _k, _l = _a.title, title = _l === void 0 ? 'CALENDAR' : _l, _m = _a.defaultTitle, defaultTitle = _m === void 0 ? '' : _m, _o = _a.defaultSubtitle, defaultSubtitle = _o === void 0 ? '' : _o, _p = _a.autoDone, autoDone = _p === void 0 ? false : _p, _q = _a.canBackwardsSelected, canBackwardsSelected = _q === void 0 ? false : _q, _r = _a.closeIcon, closeIcon = _r === void 0 ? false : _r, _s = _a.doneIcon, doneIcon = _s === void 0 ? false : _s, _t = _a.showYearPicker, showYearPicker = _t === void 0 ? false : _t, _u = _a.isSaveHistory, isSaveHistory = _u === void 0 ? false : _u, _v = _a.pickMode, pickMode = _v === void 0 ? config_1.pickModes.SINGLE : _v, _w = _a.color, color = _w === void 0 ? config_1.defaults.COLOR : _w, _x = _a.weekdays, weekdays = _x === void 0 ? config_1.defaults.WEEKS_FORMAT : _x, _y = _a.daysConfig, daysConfig = _y === void 0 ? _daysConfig : _y, _z = _a.disableWeeks, disableWeeks = _z === void 0 ? _disableWeeks : _z, _0 = _a.showAdjacentMonthDay, showAdjacentMonthDay = _0 === void 0 ? true : _0;\r\n        return {\r\n            id: id,\r\n            from: from,\r\n            to: to,\r\n            pickMode: pickMode,\r\n            autoDone: autoDone,\r\n            color: color,\r\n            cssClass: cssClass,\r\n            weekStart: weekStart,\r\n            closeLabel: closeLabel,\r\n            closeIcon: closeIcon,\r\n            doneLabel: doneLabel,\r\n            doneIcon: doneIcon,\r\n            canBackwardsSelected: canBackwardsSelected,\r\n            isSaveHistory: isSaveHistory,\r\n            disableWeeks: disableWeeks,\r\n            monthFormat: monthFormat,\r\n            title: title,\r\n            weekdays: weekdays,\r\n            daysConfig: daysConfig,\r\n            step: step,\r\n            showYearPicker: showYearPicker,\r\n            defaultTitle: defaultTitle,\r\n            defaultSubtitle: defaultSubtitle,\r\n            defaultScrollTo: calendarOptions.defaultScrollTo || from,\r\n            defaultDate: calendarOptions.defaultDate || null,\r\n            defaultDates: calendarOptions.defaultDates || null,\r\n            defaultDateRange: calendarOptions.defaultDateRange || null,\r\n            showAdjacentMonthDay: showAdjacentMonthDay\r\n        };\r\n    };\r\n    CalendarService.prototype.createOriginalCalendar = function (time) {\r\n        var date = new Date(time);\r\n        var year = date.getFullYear();\r\n        var month = date.getMonth();\r\n        var firstWeek = new Date(year, month, 1).getDay();\r\n        var howManyDays = moment(time).daysInMonth();\r\n        return {\r\n            year: year,\r\n            month: month,\r\n            firstWeek: firstWeek,\r\n            howManyDays: howManyDays,\r\n            time: new Date(year, month, 1).getTime(),\r\n            date: new Date(time)\r\n        };\r\n    };\r\n    CalendarService.prototype.findDayConfig = function (day, opt) {\r\n        if (opt.daysConfig.length <= 0)\r\n            return null;\r\n        return opt.daysConfig.find(function (n) { return day.isSame(n.date, 'day'); });\r\n    };\r\n    CalendarService.prototype.createCalendarDay = function (time, opt, month) {\r\n        var _time = moment(time);\r\n        var date = moment(time);\r\n        var isToday = moment().isSame(_time, 'days');\r\n        var dayConfig = this.findDayConfig(_time, opt);\r\n        var _rangeBeg = moment(opt.from).valueOf();\r\n        var _rangeEnd = moment(opt.to).valueOf();\r\n        var isBetween = true;\r\n        var disableWee = opt.disableWeeks.indexOf(_time.toDate().getDay()) !== -1;\r\n        if (_rangeBeg > 0 && _rangeEnd > 0) {\r\n            if (!opt.canBackwardsSelected) {\r\n                isBetween = !_time.isBetween(_rangeBeg, _rangeEnd, 'days', '[]');\r\n            }\r\n            else {\r\n                isBetween = moment(_time).isBefore(_rangeBeg) ? false : isBetween;\r\n            }\r\n        }\r\n        else if (_rangeBeg > 0 && _rangeEnd === 0) {\r\n            if (!opt.canBackwardsSelected) {\r\n                var _addTime = _time.add(1, 'day');\r\n                isBetween = !_addTime.isAfter(_rangeBeg);\r\n            }\r\n            else {\r\n                isBetween = false;\r\n            }\r\n        }\r\n        var _disable = false;\r\n        if (dayConfig && typeof dayConfig.disable === 'boolean') {\r\n            _disable = dayConfig.disable;\r\n        }\r\n        else {\r\n            _disable = disableWee || isBetween;\r\n        }\r\n        var title = new Date(time).getDate().toString();\r\n        if (dayConfig && dayConfig.title) {\r\n            title = dayConfig.title;\r\n        }\r\n        else if (opt.defaultTitle) {\r\n            title = opt.defaultTitle;\r\n        }\r\n        var subTitle = '';\r\n        if (dayConfig && dayConfig.subTitle) {\r\n            subTitle = dayConfig.subTitle;\r\n        }\r\n        else if (opt.defaultSubtitle) {\r\n            subTitle = opt.defaultSubtitle;\r\n        }\r\n        return {\r\n            time: time,\r\n            isToday: isToday,\r\n            title: title,\r\n            subTitle: subTitle,\r\n            selected: false,\r\n            isLastMonth: date.month() < month,\r\n            isNextMonth: date.month() > month,\r\n            marked: dayConfig ? dayConfig.marked || false : false,\r\n            cssClass: dayConfig ? dayConfig.cssClass || '' : '',\r\n            disable: _disable,\r\n            isFirst: date.date() === 1,\r\n            isLast: date.date() === date.daysInMonth()\r\n        };\r\n    };\r\n    CalendarService.prototype.createCalendarMonth = function (original, opt) {\r\n        var days = new Array(6).fill(null);\r\n        var len = original.howManyDays;\r\n        for (var i = original.firstWeek; i < len + original.firstWeek; i++) {\r\n            var itemTime = new Date(original.year, original.month, i - original.firstWeek + 1).getTime();\r\n            days[i] = this.createCalendarDay(itemTime, opt);\r\n        }\r\n        var weekStart = opt.weekStart;\r\n        if (weekStart === 1) {\r\n            if (days[0] === null) {\r\n                days.shift();\r\n            }\r\n            else {\r\n                days.unshift.apply(days, new Array(6).fill(null));\r\n            }\r\n        }\r\n        if (opt.showAdjacentMonthDay) {\r\n            var _booleanMap = days.map(function (e) { return !!e; });\r\n            var thisMonth = moment(original.time).month();\r\n            var startOffsetIndex = _booleanMap.indexOf(true) - 1;\r\n            var endOffsetIndex = _booleanMap.lastIndexOf(true) + 1;\r\n            for (startOffsetIndex; startOffsetIndex >= 0; startOffsetIndex--) {\r\n                var dayBefore = moment(days[startOffsetIndex + 1].time).clone().subtract(1, 'd');\r\n                days[startOffsetIndex] = this.createCalendarDay(dayBefore.valueOf(), opt, thisMonth);\r\n            }\r\n            if (!(_booleanMap.length % 7 === 0 && _booleanMap[_booleanMap.length - 1])) {\r\n                for (endOffsetIndex; endOffsetIndex < days.length + (endOffsetIndex % 7); endOffsetIndex++) {\r\n                    var dayAfter = moment(days[endOffsetIndex - 1].time).clone().add(1, 'd');\r\n                    days[endOffsetIndex] = this.createCalendarDay(dayAfter.valueOf(), opt, thisMonth);\r\n                }\r\n            }\r\n        }\r\n        return {\r\n            days: days,\r\n            original: original\r\n        };\r\n    };\r\n    CalendarService.prototype.createMonthsByPeriod = function (startTime, monthsNum, opt) {\r\n        var _array = [];\r\n        var _start = new Date(startTime);\r\n        var _startMonth = new Date(_start.getFullYear(), _start.getMonth(), 1).getTime();\r\n        for (var i = 0; i < monthsNum; i++) {\r\n            var time = moment(_startMonth).add(i, 'M').valueOf();\r\n            var originalCalendar = this.createOriginalCalendar(time);\r\n            _array.push(this.createCalendarMonth(originalCalendar, opt));\r\n        }\r\n        return _array;\r\n    };\r\n    CalendarService.prototype.wrapResult = function (original, pickMode) {\r\n        var _this = this;\r\n        var result;\r\n        switch (pickMode) {\r\n            case config_1.pickModes.SINGLE:\r\n                result = this.multiFormat(original[0].time);\r\n                break;\r\n            case config_1.pickModes.RANGE:\r\n                result = {\r\n                    from: this.multiFormat(original[0].time),\r\n                    to: this.multiFormat(original[1].time)\r\n                };\r\n                break;\r\n            case config_1.pickModes.MULTI:\r\n                result = original.map(function (e) { return _this.multiFormat(e.time); });\r\n                break;\r\n            default:\r\n                result = original;\r\n        }\r\n        return result;\r\n    };\r\n    CalendarService.prototype.multiFormat = function (time) {\r\n        var _moment = moment(time);\r\n        return {\r\n            time: _moment.valueOf(),\r\n            unix: _moment.unix(),\r\n            dateObj: _moment.toDate(),\r\n            string: _moment.format(config_1.defaults.DATE_FORMAT),\r\n            years: _moment.year(),\r\n            months: _moment.month() + 1,\r\n            date: _moment.date()\r\n        };\r\n    };\r\n    CalendarService = __decorate([\r\n        core_1.Injectable(),\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], CalendarService);\r\n    return CalendarService;\r\n}());\r\nexports.CalendarService = CalendarService;\r\n"]}